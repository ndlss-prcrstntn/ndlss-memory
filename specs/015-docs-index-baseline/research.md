# Phase 0 Research: Docs Collection Indexing + Baseline Docs Search

## Decision 1: Граница набора документов

- Decision: В docs-индексацию включаются только markdown-файлы из рабочей области проекта.
- Rationale: Это обеспечивает ожидаемую пользователем семантику "поиск по документации" без шума исходного кода.
- Alternatives considered:
  - Индексировать markdown + текстовые файлы других форматов: отклонено для MVP из-за размывания scope и неоднородного качества.
  - Индексировать весь репозиторий и фильтровать на этапе поиска: отклонено, так как усиливает шум и усложняет диагностику.

## Decision 2: Правило уникальности и идемпотентность

- Decision: Документ уникален по нормализованному пути; docs-чанк уникален по `path + stable chunk index`; факт изменения определяется хешем содержимого.
- Rationale: Это дает детерминированную идентификацию и предсказуемое обновление без дубликатов при повторных запусках.
- Alternatives considered:
  - Ключ только по хешу: отклонено из-за потери стабильной привязки к пути.
  - Ключ только по пути без chunk index: отклонено, так как невозможно устойчиво адресовать отдельные фрагменты.

## Decision 3: Создание и самовосстановление docs-коллекции

- Decision: Docs-коллекция создается на старте и повторно обеспечивается при `404` во время операций записи/удаления.
- Rationale: Поведение соответствует существующему шаблону надежности для основной коллекции и снижает риск падений после ручных удалений/сбросов.
- Alternatives considered:
  - Только startup-create: отклонено, не покрывает runtime исчезновение коллекции.
  - Только lazy-create: отклонено, хуже наблюдаемость readiness и выше риск холодных ошибок при первом запросе.

## Decision 4: Детерминизм baseline docs-поиска

- Decision: Для неизменного состояния индекса и одинакового запроса top-k выдача docs-поиска должна быть детерминированной.
- Rationale: Это необходимо для повторяемых тестов, прогнозируемого UX и стабильных контрактных проверок.
- Alternatives considered:
  - Разрешить недетерминированный tie-break: отклонено, осложняет регрессионные проверки.

## Decision 5: Формат ошибок и observability

- Decision: Docs-поиск и docs-индексация используют машиночитаемые ошибки с `errorCode`, `message`, `details`, а summary индексирования включает counts и причины пропуска.
- Rationale: Это соответствует конституции проекта и ускоряет диагностику в MCP/QA сценариях.
- Alternatives considered:
  - Только текстовые ошибки: отклонено, непригодно для автоматической обработки.

## Decision 6: Backward compatibility

- Decision: Введение docs-коллекции и docs-поиска не меняет существующие API и поведение поиска по коду.
- Rationale: Снижается риск регрессий и сохраняется предсказуемость текущих интеграций.
- Alternatives considered:
  - Унификация поиска docs/code в одном вызове сразу: отклонено на этом этапе, так как усложняет rollout и валидацию baseline метрик.
