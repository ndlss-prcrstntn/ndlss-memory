# Research: Режим Full Scan

## Контекст

Фича: `002-full-scan`
Цель: спроектировать устойчивый и наблюдаемый режим полной индексации папки для
`file-indexer` с фильтрацией и контролем ограничений.

## Решения

### Decision: Рекурсивный обход выполняется по всем вложенным директориям с предсказуемым порядком обработки
- Rationale: соответствует FR-002 и упрощает воспроизводимость результатов в тестах и логах.
- Alternatives considered:
  - Нерекурсивный обход: отклонено, нарушает требования полноты Full Scan.
  - Параллельный нерегулируемый обход: отклонено как менее предсказуемый для диагностики.

### Decision: Фильтрация по типам файлов выполняется по расширению в нечувствительном к регистру виде
- Rationale: напрямую покрывает FR-003 и FR-005, устраняет расхождения для `.MD`/`.md`.
- Alternatives considered:
  - MIME-детектирование: отклонено, увеличивает стоимость и сложность для текущего scope.
  - Чувствительное к регистру сравнение: отклонено как источник ложных пропусков.

### Decision: Исключения применяются до чтения файла на основе паттернов пути
- Rationale: соответствует FR-004 и снижает накладные расходы на обработку нецелевых файлов.
- Alternatives considered:
  - Исключение после чтения: отклонено как неэффективное.
  - Исключение только на уровне расширений: отклонено, недостаточно гибко.

### Decision: Лимит размера файла является обязательной конфигурацией для Full Scan
- Rationale: покрывает FR-007 и снижает риск деградации времени/памяти на крупных файлах.
- Alternatives considered:
  - Отсутствие лимита: отклонено как риск нестабильности.
  - Жестко зашитый лимит без конфигурации: отклонено, нарушает FR-011.

### Decision: Ошибки чтения отдельных файлов не прерывают задачу и классифицируются в отчете
- Rationale: соответствует FR-006, NFR-004 и улучшает эксплуатационную прозрачность.
- Alternatives considered:
  - Остановка задачи на первой ошибке: отклонено, снижает полезность Full Scan.
  - Логирование без классификации причин: отклонено, ухудшает диагностику.

### Decision: Прогресс Full Scan публикуется как машиночитаемый статус задачи с периодичностью не реже 60 секунд
- Rationale: покрывает FR-008, FR-009 и NFR-002, дает единый источник состояния для CLI и API.
- Alternatives considered:
  - Только текстовые логи: отклонено, неудобно для автоматизации.
  - Публикация только финального результата: отклонено, нет онлайн-наблюдения.

### Decision: Контракт задач Full Scan оформляется отдельным OpenAPI-файлом фичи
- Rationale: сохраняет трассируемость к фиче и поддерживает конституционное требование формализованных контрактов.
- Alternatives considered:
  - Изменять только существующий observability-контракт: отклонено, смешивает разные домены API.
  - Неформальная документация без схем: отклонено как нетестируемое решение.

## Исследовательские задачи и закрытие неопределенностей

- Task: "Find best practices for directory traversal in file indexing domain" -> закрыто решением по предсказуемому рекурсивному обходу.
- Task: "Find best practices for file filtering and exclusion patterns" -> закрыто решением о pre-read фильтрации.
- Task: "Find patterns for progress reporting in long-running indexing jobs" -> закрыто решением о job-status API.
- Task: "Find best practices for resilient error handling in batch file processing" -> закрыто решением о continue-on-error + классификация причин.

`NEEDS CLARIFICATION` в `plan.md` отсутствуют.
