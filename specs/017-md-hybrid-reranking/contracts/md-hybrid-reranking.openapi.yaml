openapi: 3.0.3
info:
  title: Markdown Hybrid Reranking Search Contract
  version: 0.1.0
  description: Contract for docs-only search with reranking on top of hybrid (BM25 + vector) candidates.

paths:
  /v1/search/docs/query:
    post:
      summary: Execute docs-only hybrid search with reranking
      operationId: docsHybridRerankingSearch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocsRerankedSearchRequest'
      responses:
        '200':
          description: Successful docs reranked search response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DocsRerankedSearchResponse'
        '400':
          description: Invalid request payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '503':
          description: Docs collection or reranking stage temporarily unavailable
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    DocsRerankedSearchRequest:
      type: object
      required: [query]
      properties:
        query:
          type: string
          minLength: 1
        limit:
          type: integer
          minimum: 1
          maximum: 50
          default: 10
        workspacePath:
          type: string

    DocsRerankedSearchResponse:
      type: object
      required: [query, total, appliedStrategy, fallbackApplied, results]
      properties:
        query:
          type: string
        total:
          type: integer
          minimum: 0
        appliedStrategy:
          type: string
          enum: [bm25_plus_vector_rerank_docs_only]
        fallbackApplied:
          type: boolean
        results:
          type: array
          items:
            $ref: '#/components/schemas/DocsRerankedResultItem'

    DocsRerankedResultItem:
      type: object
      required: [documentPath, chunkIndex, snippet, score, sourceType, rankingSignals]
      properties:
        documentPath:
          type: string
        chunkIndex:
          type: integer
          minimum: 0
        snippet:
          type: string
        score:
          type: number
        sourceType:
          type: string
          enum: [documentation]
        rankingSignals:
          type: object
          required: [lexical, semantic, rerank]
          properties:
            lexical:
              type: number
              minimum: 0
            semantic:
              type: number
              minimum: 0
            rerank:
              type: number
              minimum: 0

    ErrorResponse:
      type: object
      required: [errorCode, message]
      properties:
        errorCode:
          type: string
          enum:
            - INVALID_REQUEST
            - SEARCH_QUERY_EMPTY
            - DOCS_COLLECTION_UNAVAILABLE
            - DOCS_RERANKING_UNAVAILABLE
            - INTERNAL_ERROR
        message:
          type: string
        details:
          type: string
