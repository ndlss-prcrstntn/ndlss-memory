# Research: MCP-инструменты поиска

## Контекст

Фича: `006-mcp-search-tools`
Цель: определить устойчивый и предсказуемый дизайн MCP-инструментов поиска с
фильтрами и трассируемостью источника результата.

## Исследовательские задачи

- Task: "Find best practices for semantic search tool contracts in MCP systems"
- Task: "Find patterns for source/metadata traceability by result ID"
- Task: "Find best practices for filter semantics (path/folder/fileType)"
- Task: "Find empty-result and error-response patterns for machine-readable APIs"

## Решения

### Decision: Использовать единый формат search-tool ответа с полями `status`, `results`, `meta`
- Rationale: единый формат упрощает использование несколькими агентами и снижает
  риск несовместимых клиентских парсеров.
- Alternatives considered:
  - Разные payload-форматы на каждый tool: отклонено как менее предсказуемое.
  - Только свободный текстовый ответ: отклонено, не подходит для автоматизации.

### Decision: Делать source/metadata retrieval по стабильному `resultId`
- Rationale: создается явная связь между выдачей semantic search и последующими
  запросами, без повторного поиска и эвристик сопоставления.
- Alternatives considered:
  - Retrieval по raw path: отклонено, путь может быть неоднозначен при rename.
  - Retrieval по позиции в выдаче: отклонено, нестабильно между запросами.

### Decision: Применять фильтры `path`, `folder`, `fileType` как логическое И
- Rationale: это наиболее предсказуемая модель для narrowing поиска и исключает
  неожиданные расширения выдачи.
- Alternatives considered:
  - Логическое ИЛИ между фильтрами: отклонено как менее контролируемое поведение.
  - Поддержка только одного фильтра за запрос: отклонено, снижает практическую ценность.

### Decision: Пустая выдача является успешным ответом, а не ошибкой
- Rationale: отсутствие результатов — корректный пользовательский исход поиска,
  который должен отличаться от системной ошибки.
- Alternatives considered:
  - Возврат 404/ошибки при пустой выдаче: отклонено, вводит ложные ошибки.
  - Скрытая подмена пустой выдачи fallback-данными: отклонено, снижает прозрачность.

### Decision: Для невалидного/неизвестного ID возвращать машиночитаемые error codes
- Rationale: требуется для контрактного тестирования и надежной автоматической
  обработки ошибок агентами.
- Alternatives considered:
  - Только текстовое сообщение: отклонено, тяжело маршрутизировать в клиентах.

## Outcome

`NEEDS CLARIFICATION` отсутствуют; все критичные решения по контракту, фильтрам,
трассируемости ID и empty-result поведению зафиксированы.
