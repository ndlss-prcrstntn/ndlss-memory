# Спецификация фичи: Базовый Docker Compose стек

**Feature Branch**: `001-base-docker-compose`
**Created**: 2026-02-21
**Status**: Draft
**Input**: User description: "Создаем базовый docker-compose"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Запуск стека одной командой (Priority: P1)

Как пользователь проекта, я хочу запустить базовый стек одной командой,
чтобы быстро получить работающее окружение без ручной настройки каждого сервиса.

**Why this priority**: Без базового запуска остальные фичи (индексация и MCP-вызовы)
невозможно реализовать и проверить.

**Independent Test**: На чистом окружении пользователь выполняет одну команду запуска,
после чего все обязательные сервисы переходят в состояние "healthy".

**Acceptance Scenarios**:

1. **Given** установлен Docker и склонирован репозиторий, **When** пользователь
   запускает стек, **Then** обязательные сервисы стартуют без ручной правки файлов.
2. **Given** стек запущен, **When** пользователь проверяет состояние сервисов,
   **Then** каждый обязательный сервис доступен и отвечает по healthcheck.

---

### User Story 2 - Понятная первичная конфигурация (Priority: P2)

Как пользователь проекта, я хочу иметь прозрачные параметры запуска,
чтобы адаптировать окружение под локальную машину без изменения исходного кода.

**Why this priority**: Конфигурация влияет на воспроизводимость запуска у других
пользователей и на вероятность ошибок при первом старте.

**Independent Test**: Пользователь меняет значения в шаблоне переменных окружения,
после чего стек запускается с новыми параметрами без модификации compose-файла.

**Acceptance Scenarios**:

1. **Given** пользователь изменил параметры в `.env`, **When** он перезапускает
   стек, **Then** сервисы работают с обновленными значениями.

---

### User Story 3 - Базовая эксплуатационная прозрачность (Priority: P3)

Как пользователь проекта, я хочу видеть минимально необходимую диагностику и
инструкции по восстановлению, чтобы самостоятельно решать типовые проблемы запуска.

**Why this priority**: Понижает порог входа для внешних пользователей GitHub и
сокращает время на поддержку.

**Independent Test**: Пользователь, следуя документации, может определить
неработающий сервис и выполнить стандартные шаги восстановления.

**Acceptance Scenarios**:

1. **Given** один из сервисов не запускается, **When** пользователь следует
   разделу troubleshooting, **Then** он может локализовать и исправить проблему.

---

### Edge Cases

- Что происходит, если порт одного из сервисов уже занят на хосте?
- Что происходит, если Docker volume недоступен или поврежден?
- Как система ведет себя при повторном запуске после принудительной остановки?
- Что делает запуск, если отсутствует файл `.env`?
- Как документируется поведение при нехватке ресурсов (RAM/диск)?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система MUST запускать базовый стек одной командой из корня проекта.
- **FR-002**: Базовый стек MUST включать сервисы `qdrant`, `file-indexer`,
  `mcp-server`.
- **FR-003**: Каждый сервис MUST иметь healthcheck со статусом, доступным
  пользователю.
- **FR-004**: Конфигурация запуска MUST быть вынесена в переменные окружения с
  шаблоном значений по умолчанию.
- **FR-005**: Для данных Qdrant MUST быть определено персистентное хранилище,
  сохраняющее состояние между перезапусками.
- **FR-006**: Для индексации MUST быть определен mount рабочей директории,
  позволяющий читать файлы проекта.
- **FR-007**: Документация MUST содержать быстрый старт, проверку состояния
  сервисов и шаги безопасной остановки/очистки.
- **FR-008**: Система MUST предоставлять единый способ просмотра статуса
  сервисов, пригодный для первичной диагностики.

### Non-Functional Requirements *(mandatory)*

- **NFR-001**: Новый пользователь должен поднять базовый стек за 10 минут или
  быстрее по инструкции в репозитории.
- **NFR-002**: Повторный запуск без изменения конфигурации должен давать
  предсказуемый результат и не требовать ручного восстановления.
- **NFR-003**: Инструкции запуска должны быть понятны пользователю без знания
  внутренней архитектуры проекта.

### Assumptions

- Пользователь работает в локальной среде, где доступны Docker и Docker Compose.
- В первую итерацию входит только базовая orchestration-подготовка, без
  детальной реализации логики индексации и MCP-инструментов.
- Сетевой доступ к контейнерным образам доступен в момент первого запуска.

### Key Entities *(include if feature involves data)*

- **ComposeService**: описание сервиса в стеке (имя, состояние, healthcheck).
- **RuntimeConfig**: набор параметров запуска из переменных окружения.
- **VolumeBinding**: привязка хранилища к сервису (тип, цель, режим).

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Не менее 90% новых пользователей запускают базовый стек с первой
  попытки, следуя quickstart без дополнительных пояснений.
- **SC-002**: 100% обязательных сервисов переходят в состояние "healthy" в
  целевом сценарии запуска.
- **SC-003**: Пользователь может остановить и заново поднять стек без потери
  данных Qdrant в стандартном цикле перезапуска.
- **SC-004**: Время первичного запуска до готовности сервисов не превышает
  10 минут на типовой машине разработки.
